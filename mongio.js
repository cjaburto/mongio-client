(function(){var e,r;r=void 0===window.socket||""===window.socket||null===window.socket?io():window.socket,e=function(){function e(){}return e.prototype.collection=function(e){return{connect:function(t){var o,n;return o=Q.defer(),n={db:t.db,collection:e,user:t.user,field:t.field},r.emit("connectDb",n,function(e){return"ok"===e.status&&o.resolve(e.res),"err"===e.status?o.reject(new Error(e.err)):void 0}),o.promise},login:function(t){var o,n;return o=Q.defer(),n={collection:e,query:t},r.emit("login",n,function(e){switch(e.status){case"ok":return o.resolve(e.res);case"!match":return o.resolve("!match");case"err":return o.reject(new Error(e.err))}}),o.promise},find:function(t,o,n,s){var i,u;return i=Q.defer(),void 0===n&&(n=""),void 0===s&&(s=""),void 0===t&&(t={}),u={collection:e,query:t,proyection:o,limit:n,skip:s},r.emit("find",u,function(e){return"ok"===e.status&&i.resolve(e.res),"err"===e.status?i.reject(new Error(e.err)):void 0}),i.promise},findOne:function(t){var o,n;return n=Q.defer(),o={collection:e,query:t},r.emit("findOne",o,function(e){return"ok"===e.status&&n.resolve(e.res),"!exist"===e.status&&n.resolve("!exist"),"err"===e.status?n.reject(new Error(e.err)):void 0}),n.promise},remove:function(t){var o,n;return n=Q.defer(),o={collection:e,query:t},r.emit("remove",o,function(e){return"ok"===e.status&&n.resolve(e.res),"err"===e.status?n.reject(new Error(e.err)):void 0}),n.promise},save:function(t,o){var n,s;return console.log("query "+t+" verify "+o),n=Q.defer(),s={collection:e,query:t,verify:o},r.emit("save",s,function(e){switch(e.status){case"ok":return n.resolve(e.res);case"exist":return n.resolve("exist");case"err":return n.reject(new Error(e.err))}}),n.promise},update:function(t,o){var n,s;return n=Q.defer(),s={collection:e,query:t,update:o},r.emit("update",s,function(e){switch(e.status){case"ok":return n.resolve(e.res);case"err":return n.reject(new Error(e.err))}}),n.promise},password:function(t){var o,n;return n=Q.defer(),o={collection:e,user:t.user,newPass:t.newPass,oldPass:t.oldPass},r.emit("changePass",o,function(e){switch(res.status){case"ok":return n.resolve(e.res);case"!match":return n.resolve("!match");case"err":return n.reject(new Error(e.err))}}),n.promise},drop:function(){var t;return t=Q.defer(),r.emit("drop",e,function(e){return"ok"===e.status&&t.resolve(e.res),"err"===e.status?t.reject(new Error(e.err)):void 0}),t.promise}}},e.prototype.mongoimport=function(e){var t;return t=Q.defer(),r.emit("mongoimport",e,function(e){return"ok"===e.status&&t.resolve(e.res),"stderr"===e.status&&t.reject(new Error(e.err)),"err"===e.status?t.reject(new Error(e.err)):void 0}),t.promise},e}(),window.db=new e}).call(this);