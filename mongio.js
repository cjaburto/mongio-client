(function(){var r,e;e=void 0===window.socket||""===window.socket||null===window.socket?io():window.socket,r=function(){function r(){}return r.prototype.collection=function(r){return{connect:function(t){var o,n;return o=Q.defer(),n={db:t.db,collection:r,user:t.user,field:t.field},e.emit("connectDb",n,function(r){return"ok"===r.status&&o.resolve(r.res),"err"===r.status?o.reject(new Error(r.err)):void 0}),o.promise},login:function(t){var o,n;return o=Q.defer(),n={collection:r,query:t},e.emit("login",n,function(r){switch(r.status){case"ok":return o.resolve(r.res);case"!match":return o.resolve("!match");case"err":return o.reject(new Error(r.err))}}),o.promise},find:function(t){return{vlimit:void 0,vskip:void 0,vsort:void 0,vproy:void 0,limit:function(r){return this.vlimit=r,this},skip:function(r){return this.vskip=r,this},sort:function(r){return this.vsort=r,this},complete:function(o){var n;return void 0===t&&(t={}),void 0===this.vsort&&(this.vsort={_id:-1}),n={collection:r,query:t,skip:this.vskip,limit:this.vlimit,sort:this.vsort,proyection:this.vproy},e.emit("find",n,function(r){return o(r)}),this}}},findOne:function(t){var o,n;return n=Q.defer(),o={collection:r,query:t},e.emit("findOne",o,function(r){return"ok"===r.status&&n.resolve(r.res),"!exist"===r.status&&n.resolve("!exist"),"err"===r.status?n.reject(new Error(r.err)):void 0}),n.promise},remove:function(t){var o,n;return n=Q.defer(),o={collection:r,query:t},e.emit("remove",o,function(r){return"ok"===r.status&&n.resolve(r.res),"err"===r.status?n.reject(new Error(r.err)):void 0}),n.promise},save:function(t,o){var n,s;return console.log("query "+t+" verify "+o),n=Q.defer(),s={collection:r,query:t,verify:o},e.emit("save",s,function(r){switch(r.status){case"ok":return n.resolve(r.res);case"exist":return n.resolve("exist");case"err":return n.reject(new Error(r.err))}}),n.promise},update:function(t,o){var n,s;return n=Q.defer(),s={collection:r,query:t,update:o},e.emit("update",s,function(r){switch(r.status){case"ok":return n.resolve(r.res);case"err":return n.reject(new Error(r.err))}}),n.promise},password:function(t){var o,n;return n=Q.defer(),o={collection:r,user:t.user,newPass:t.newPass,oldPass:t.oldPass},e.emit("changePass",o,function(r){switch(res.status){case"ok":return n.resolve(r.res);case"!match":return n.resolve("!match");case"err":return n.reject(new Error(r.err))}}),n.promise},drop:function(){var t;return t=Q.defer(),e.emit("drop",r,function(r){return"ok"===r.status&&t.resolve(r.res),"err"===r.status?t.reject(new Error(r.err)):void 0}),t.promise}}},r.prototype.mongoimport=function(r){var t;return t=Q.defer(),e.emit("mongoimport",r,function(r){return"ok"===r.status&&t.resolve(r.res),"stderr"===r.status&&t.reject(new Error(r.err)),"err"===r.status?t.reject(new Error(r.err)):void 0}),t.promise},r}(),window.db=new r}).call(this);